## gcc编译c++文件

编译c++文件本应使用 `g++` 命令的，但 `gcc` 也不是不可以，使用 `gcc` 命令：
``` shell
gcc -x c++ main.cpp func.cpp -lstdc++ -o main.exe
```
- `-x` 指定源文件为 `c++` 文件
- `-lstdc++` 指定 `c++` 的标准库

### options
- `-L` 
- `-l`
- `-I`
- `-g`

## 编译过程
![GNU Compiler](GNU%20Compiler.md)
 `cc1`将高级语言转换为汇编文件，它本身现已不存在，只能由`gcc`调用，它接受的文件可以是源文件，也可以是预处理后的文件。
 
当gcc链接多个对象文件或库时，它会调用`collect2`，`collect2`随后再调用实际的链接器（如`ld`）。与`cc1`一样，作为普通用户，通常不会直接与`collect2`交互，而是通过`gcc`间接地使用它。


## Binutils
- ``addr2line`` 把程序地址转换为文件名和行号。在命令行中给它一个地址和一个可执行文件名，它就会使用这个可执行文件的调试信息指出在给出的地址上是哪个文件以及行号。
- ``ar`` 建立、修改、提取归档文件。归档文件是包含多个文件内容的一个大文件，其结构保证了可以恢复原始文件内容。
- ``as`` 主要用来编译GNU C编译器gcc输出的汇编文件，产生的目标文件由连接器ld连接。
- ``c++filt`` 连接器使用它来过滤 C++ 和 Java 符号，防止重载函数冲突。
- ``gprof`` 显示程序调用段的各种数据。
- ``ld`` 是连接器，它把一些目标和归档文件结合在一起，重定位数据，并连接符号引用。通常，建立一个新编译程序的最后一步就是调用ld。
- ``nm`` 列出目标文件中的符号。
- ``objcopy`` 把一种目标文件中的内容复制到另一种类型的目标文件中。
- ``objdump`` 显示一个或者更多目标文件的信息。使用选项来控制其显示的信息，它所显示的信息通常只有编写编译工具的人才感兴趣。
- ``ranlib`` 产生归档文件索引，并将其保存到这个归档文件中。在索引中列出了归档文件各成员所定义的可重分配目标文件。
- ``readelf`` 显示elf格式可执行文件的信息。
- ``size`` 列出目标文件每一段的大小以及总体的大小。默认情况下，对于每个目标文件或者一个归档文件中的每个模块只产生一行输出。
- ``strings`` 打印某个文件的可打印字符串，这些字符串最少4个字符长，也可以使用选项-n设置字符串的最小长度。默认情况下，它只打印目标文件初始化和可加载段中的可打印字符；对于其他类型的文件它打印整个文件的可打印字符。这个程序对于了解非文本文件的内容很有帮助。
- ``strip`` 丢弃目标文件中的全部或者特定符号。
- ``libiberty`` 包含许多GNU程序都会用到的函数，这些程序有getopt、obstack、strerror、strtol和strtoul。
- ``libbfd`` 二进制文件描述库。
- ``libopcode`` 用来处理opcodes的库，在生成一些应用程序的时候也会用到它。


## 生成静态库
`libxxx.a | xxx.lib`
1. `gcc -c file.c -o file.o` 先生成非链接的目标文件
2. `ar rcs libmystatic.a file.o` 通过 `ar` 工具创建静态库

## 生成动态库
也称**运行时**：`xxx.so | xxx.dll`
1. `gcc -fPIC -c file.c -o file.o` 编译源文件为位置无关代码(目标文件)
2. `gcc -shared -o file.o libmyshared` 通过 `-shared` 创建动态库

## 链接
**对于C++标准库文件，编译器通常会自动进行链接**。这是通过编译器和链接器内置的知识和配置来实现的。

具体来说，当你使用C++编译器（如GCC或Clang）编译一个源文件时，编译器会识别出源文件中使用的标准库函数和特性。在编译的后期阶段，编译器会生成一些需要链接器处理的中间代码或目标文件。这些目标文件会包含对标准库中函数的引用。

链接器是负责将编译后的目标文件以及所需的库文件组合成一个可执行文件的工具。当链接器处理这些目标文件时，它会检查其中的引用，并尝试解析这些引用到实际的库函数定义。对于C++标准库中的函数，链接器知道这些函数位于标准库中，并会自动链接到相应的库文件。

这种自动链接是通过链接器的配置和预定义搜索路径来实现的。**编译器和链接器通常会预配置一组默认的库文件搜索路径，这些路径中包含了标准库的库文件**。链接器会在这些路径中查找并链接所需的库文件。

需要注意的是，虽然编译器会自动链接标准库，但如果你使用了特定的编译器选项或配置，可能会影响自动链接的行为。此外，如果你使用的是第三方库或自定义库，你可能需要手动指定库文件的路径和名称，以便链接器能够正确地链接它们。
